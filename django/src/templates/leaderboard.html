{% load static %}
<link rel="stylesheet" href="{% static 'css/leaderboard.css' %}">

<div class="container">
    <h1>Classement Pong</h1>
	<div class="horizontal-line"></div>
    <div class="table-container">
        <table id="leaderboard-table">
            <thead>
                <tr>
                    <th>Rang</th>
                    <th>Joueur</th>
                    <th>Elo</th>
                </tr>
            </thead>
            <tbody>
                {% for user in users %}
                <tr>
                    <td>{{ forloop.counter }}</td>
                    <td class="player-info">
                        {% if user.profile_picture %}
                            <img src="{{ user.profile_picture.url }}" alt="{{ user.username }}" class="profile-picture">
                        {% else %}
                            <div class="profile-picture default">
                                <span>{{ user.username|first|upper }}</span>
                            </div>
                        {% endif %}
                        <span class="username">{{ user.username }}</span>
                        <!-- Pastille verte -->
                  	</td>
                    <td class="elo">{{ user.elo }} PP</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Match History Section -->
<div class="container">
	<h1>Historique des parties</h1>

	{% if user_history %}
	<div class="table-container">
		<table id="leaderboard-table">
			<thead>
				<tr>
					<th>Date</th>
					<th>Adversaire</th>
					<th>Type de match</th>
					<th>Résultat</th>
				</tr>
			</thead>
			<tbody>
				{% for match in user_history %}
				<tr class="match-played {% if match.result == 'win' %}win{% elif match.result == 'loss' %}loss{% endif %}">
					<td>{{ match.timestamp|slice:":19" }}</td>
					<td class="player-info">
						{% if match.opponent_picture_url %}
							<img src="{{ match.opponent_picture_url }}" alt="{{ match.opponent_username }}" class="profile-picture">
						{% else %}
							<div class="profile-picture">
								<span>{{ match.opponent_username|first|upper }}</span>
							</div>
						{% endif %}
						<span class="username">{{ match.opponent_username }}</span>
					</td>
					<td>
						{% if match.match_type == 'tournament_semifinal' %}
							Demi-finale de tournoi
						{% elif match.match_type == 'tournament_third_place' %}
							Match pour la 3ème place
						{% elif match.match_type == 'tournament_final' %}
							Finale de tournoi
						{% else %}
							Match classique
						{% endif %}
					</td>
					<td class="win-loose">
						{% if match.result == 'win' %}
							<span class="result win">Victoire</span>
						{% elif match.result == 'loss' %}
							<span class="result loss">Défaite</span>
						{% elif match.result == 'forfeit' %}
							<span class="result forfeit">Forfait</span>
						{% else %}
							{{ match.result }}
						{% endif %}
					</td>
				</tr>
				{% endfor %}
			</tbody>
		</table>
	</div>
	{% else %}
	<div class="">
		<p>Vous n'avez pas encore joué de match. Participez à un match ou à un tournoi pour voir votre historique ici.</p>
	</div>
	{% endif %}
</div>

<!-- Add this CSS to match your friends.html styling for profile pictures -->
<style>
    .profile-picture {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        object-fit: cover;
        display: inline-flex;
    }
</style>

<script src="{% static 'js/leaderboard.js' %}"></script>
